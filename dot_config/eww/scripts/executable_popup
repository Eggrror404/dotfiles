#!/usr/bin/env bash

toggle_widget() {
  WIDGET=$1
  TOGGLE=$2 # "open" or "close" or empty

  # Run eww daemon if not running
  if [[ ! $(eww ping) ]]; then
    eww daemon
    sleep 1
  fi

  close() {
    [ "$TOGGLE" != "open" ] &&
      eww close "$WIDGET" 2>/dev/null >/dev/null &&
      echo "Closed $WIDGET"
  }

  open() {
    [ "$TOGGLE" != "close" ] &&
      eww open "$WIDGET" >/dev/null &&
      echo "Opened $WIDGET"
  }

  close || open
}

menu() {
  toggle_dashboard close >/dev/null 2>/dev/null || true
  sh "$HOME/.config/rofi/scripts/$1"
}

# don't launch immediately so eww doesn't freeze
sleep 0.05

if [ "$1" = "bluetooth" ]; then
  blueman-manager
elif [ "$1" = "network" ]; then
  nm-connection-editor
elif [ "$1" = "launcher" ]; then
  menu launcher.sh
elif [ "$1" = "audio" ]; then
  menu audio.sh
elif [ "$1" = "game" ]; then
  menu game-lib.sh
elif [ "$1" = "screenshot" ]; then
  menu screenshot.sh
elif [ "$1" = "emoji" ]; then
  menu emoji.sh
elif [ "$1" = "calc" ]; then
  menu calc.sh
elif [ "$1" = "dashboard" ]; then
  toggle_widget dashboard "$2"
elif [ "$1" = "calendar" ]; then
  toggle_widget calendar "$2"
elif [ "$1" = "update" ]; then
  alacritty --hold -e sh -c 'yay; eww update updates=`~/.config/eww/scripts/updates`'
fi
